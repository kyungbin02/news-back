<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="myapp.backend.domain.notification.mapper.NotificationMapper">

    <!-- 알림 저장 -->
    <insert id="insertNotification" parameterType="myapp.backend.domain.notification.vo.NotificationVO" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO notifications (
            user_id,
            admin_id,
            notification_type,
            notification_title,
            notification_message,
            is_read,
            created_at,
            updated_at
        ) VALUES (
            #{user_id},
            #{admin_id},
            #{notification_type},
            #{notification_title},
            #{notification_message},
            #{is_read},
            NOW(),
            NOW()
        )
    </insert>

    <!-- 사용자 알림 조회 -->
    <select id="getNotificationsByUserId" parameterType="int" resultType="myapp.backend.domain.notification.vo.NotificationVO">
        SELECT 
            id,
            user_id,
            admin_id,
            notification_type,
            notification_title,
            notification_message,
            is_read,
            created_at,
            updated_at
        FROM notifications 
        WHERE user_id = #{user_id}
        ORDER BY created_at DESC
    </select>

    <!-- 디버깅용: 모든 알림 조회 -->
    <select id="getAllNotifications" resultType="myapp.backend.domain.notification.vo.NotificationVO">
        SELECT 
            id,
            user_id,
            admin_id,
            notification_type,
            notification_title,
            notification_message,
            is_read,
            created_at,
            updated_at
        FROM notifications 
        ORDER BY created_at DESC
        LIMIT 10
    </select>

    <!-- 관리자 알림 조회 -->
    <select id="getAdminNotifications" resultType="myapp.backend.domain.notification.vo.NotificationVO">
        SELECT 
            id,
            user_id,
            admin_id,
            notification_type,
            notification_title,
            notification_message,
            is_read,
            created_at,
            updated_at
        FROM notifications 
        WHERE user_id IS NULL
        ORDER BY created_at DESC
    </select>

    <!-- 알림 읽음 처리 -->
    <update id="markAsRead" parameterType="long">
        UPDATE notifications 
        SET is_read = TRUE, updated_at = NOW()
        WHERE id = #{id}
    </update>

</mapper>
